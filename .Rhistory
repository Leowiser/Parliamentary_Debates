theme(axis.text.x = element_text(angle = 45, hjust = 1))
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter)) +
# Plot Government and Opposition lines and points with color mapping
geom_line(aes(y = Government, color = "Government"), size = .1) +
geom_point(aes(y = Government, color = "Government"), size = 6, shape = 1, stroke = .25) +
geom_line(aes(y = Opposition, color = "Opposition"), size = .1) +
geom_point(aes(y = Opposition, color = "Opposition"), size = 6, shape = 1, stroke = .25) +
# Add smoothed lines with corresponding colors
geom_line(aes(y = sentismooth_government, color = "Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, color = "Opposition"), size = 2) +
# Properly map colors for the legend
scale_color_manual(name = "Group",
values = c("Government" = "#3F5F75", "Opposition" = "#3FA8C3")) +
# Set labels and theme adjustments
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position=c(0.25,0.8),
legend.text = element_text(size = 10),
legend.key.height=unit(1.5,"line"),
legend.key.size=unit(2.5,"line"),
legend.key = element_blank())
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position=c(0.1,0.8),
legend.text = element_text(size = 10),
legend.key.height=unit(1.5,"line"),
legend.key.size=unit(2.5,"line"),
legend.key = element_blank())
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position=c(0.4,0.8),
legend.text = element_text(size = 10),
legend.key.height=unit(1.5,"line"),
legend.key.size=unit(2.5,"line"),
legend.key = element_blank())
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position=c(0.4,0.1),
legend.text = element_text(size = 10),
legend.key.height=unit(1.5,"line"),
legend.key.size=unit(2.5,"line"),
legend.key = element_blank())
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position=c(0.4,0.2),
legend.text = element_text(size = 10),
legend.key.height=unit(1.5,"line"),
legend.key.size=unit(2.5,"line"),
legend.key = element_blank())
library("tidyverse")
library("httr")
library("jsonlite")
library("rvest")
library("xml2")
library("glue")
library("data.table")
library("rvest")
library("xml2")
library("glue")
library("data.table")
library("quanteda")
library("topicmodels")
library(readxl)
library(tm)
library(tidytext)
library(dplyr)
library(lubridate)    # for date conversion in data cleaning
library(udpipe)    # for POS tagging
library(spacyr)    # for POS tagging
library(writexl)    # to write xlsx
#############################
###     Data Cleaning     ###
#############################
# Load the web scraped data
df_Debates = read.csv("Parliamentary_Debates_Combined.csv", row.names = 1)
# Delete all duplicated rows
df_clean <- distinct(df_Debates)
# Delete all rows where no speaker name exists as these are often not real speeches
# but the descriptions of the following debates
df_clean <- df_clean[!is.na(df_clean$speaker_name),]
# We will now try to find reoccurring speech contents to discard
# sentences that are following parliamental protocol but have no real meaning.
# However, they could effect our sentiment analysis.
df_value_counts <- df_clean %>%
group_by(speech_content) %>%
summarize(count = n()) %>%
filter(count > 4)
# Found sentences that occur often and should be filtered out as they are part of the
# parliamentary culture.
filter_list <- c("rose—","On a point of order, Mr Speaker.","indicated assent.",
"Will the Secretary of State give way?","indicated dissent.",
"Will my right hon. Friend give way?","Will the hon. Lady give way?",
"Will my hon. Friend give way?","Will the right hon. Gentleman give way?",
"Will the Minister give way?","Will the hon. Gentleman give way?",
"Will my right hon. and learned Friend give way?","Order.",
"Will the hon. and learned Lady give way?","Will the right hon. Lady give way?",
"I beg to move, That the clause be read a Second time.","rose —",
"Will the Prime Minister give way?","Will my hon. and learned Friend give way?",
"Will the Attorney General give way?","I will.",
"Will the hon. Gentleman give way on that point?","Will the Solicitor General give way?",
"Will the hon. and learned Gentleman give way?","I give way to my hon. Friend.",
"Will the Minister give way on that point?","I will give way to my hon. Friend.",
"Will my hon. Friend give way on that point?","Will the Foreign Secretary give way?",
"Will the hon. Lady give way on that point?","rose—[Interruption.]","I give way.",
"I will give way one more time.","I give way to the hon. Gentleman.",
"I will give way one last time.")
df_clean <- df_clean %>% filter(!speech_content %in% filter_list)
# clean the party column
# Check which parties exist
table(df_clean$speaker_party)
# List of parties in the parliament
Parties <- c("Liberal Democrat", "Liberal Democrats", "Independent",
"Labour/Co-operative", "Co-operative","Labour", "Green",
"DUP", "Speaker", "Scottish National Party", "Conservative",
"Secretary","Shadow Minister", "Minister", "Plaid Cymru")
# Initialize a new column to store the matching substring(s)
df_clean$Party <- NA
# Loop through the search list and check for each substring, with case insensitivity
for (search_string in Parties) {
# Create a regex pattern to make the match more flexible
pattern <- paste0("\\b", search_string, "s?\\b")
# Add the substring to the new column if it's found in the Text column
df_clean$Party <- ifelse(grepl(pattern, df_clean$speaker_party, ignore.case = TRUE),
ifelse(is.na(df_clean$Party), search_string,
paste(df_clean$Party, search_string, sep = ", ")),
df_clean$Party)
}
table(df_clean$Party)
df_clean$Party <- gsub("Co-operative, Shadow Minister, Minister", "Co-operative", df_clean$Party)
df_clean$Party <- gsub("Green, Shadow Minister, Minister", "Green", df_clean$Party)
df_clean$Party <- gsub("Conservative, Minister", "Conservative", df_clean$Party)
df_clean$Party <- gsub("Labour, Secretary", "Labour", df_clean$Party)
df_clean$Party <- gsub("Labour, Secretary, Shadow Minister, Minister", "Labour", df_clean$Party)
df_clean$Party <- gsub("Labour/Co-operative, Co-operative, Labour", "Labour/Co-operative", df_clean$Party)
df_clean$Party <- gsub("Liberal Democrat, Liberal Democrats", "Liberal Democrat", df_clean$Party)
df_clean$Party <- gsub("Labour, Shadow Minister, Minister", "Labour", df_clean$Party)
df_clean$Party <- gsub("Independent, Speaker", "Independent", df_clean$Party)
table(df_clean$speaker_name[df_clean$Party=="Secretary, Shadow Minister, Minister"])
table(df_clean$speaker_name[df_clean$Party=="Shadow Minister, Minister"])
table(df_clean$speaker_name[df_clean$Party=="Secretary, Shadow Minister, Minister"])
table(df_clean$speaker_name[df_clean$Party=="Secretary, Minister"])
table(df_clean$speaker_name[df_clean$Party=="Speaker, Secretary"])
table(df_clean$speaker_name[df_clean$Party=="Green, Conservative"])
table(df_clean$speaker_name[df_clean$Party=="Labour, Green"])
table(df_clean$speaker_name[df_clean$Party=="Liberal Democrat, DUP"])
table(df_clean$speaker_name[df_clean$Party=="Minister"])
table(df_clean$speaker_name[df_clean$Party=="Secretary"])
# Hand coded data frame based on the names gathered from the table before
new_party = read_excel("New party.xlsx")
# Based on the previous data frame combine the names with the assigned party.
# There are no names liste twice.
df_clean <- df_clean %>%
left_join(new_party, by = "speaker_name", suffix = c("", ".new")) %>%
mutate(Party = coalesce(Party.new, Party)) %>%
select(-Party.new)
table(df_clean$Party)
# Delete the phrase "I beg to move" as it is mandatory at the beginning of every debate
df_clean$speech_content <- sub("^I beg to move","",df_clean$speech_content)
# Format the debate_date column so that it contains dates not character strings
df_clean$debate_date <- dmy(df_clean$debate_date)
# A later function needs the speeches to be in a column called 'text' se we rename it
names(df_clean)[names(df_clean) == "speech_content"] <- "text"
# Add a new column indicating whether the party was in the opposition or government at that time.
df_clean$Government_Opposition <- ifelse(
(df_clean$Party == "Conservative" & df_clean$debate_date <= as.Date("2015-05-08")) |
(df_clean$Party == "Conservative" & df_clean$debate_date > as.Date("2015-05-08")
& df_clean$debate_date < as.Date("2019-12-16")) |
(df_clean$Party == "DUP" & df_clean$debate_date > as.Date("2015-05-08")
& df_clean$debate_date < as.Date("2019-12-16")),
"Government",
ifelse(
df_clean$Party == "Conservative" & df_clean$debate_date >= as.Date("2019-12-16"),
"Government",
"Opposition"
)
)
# Load the lexicon from Rheault et al. (2016)
sentiment_lexicon <- read.csv("lexicon-polarity.csv")
# Remove irrelevant column
sentiment_lexicon %>% select(-seed) -> sentiment_lexicon
knitr::kable(head(sentiment_lexicon), caption = "Observations form the lexicon of Rheault et al. (2016)")
# Load the POS tagged data and model
load("pos.RData")
m_eng_loaded <- udpipe_load_model(file = "english-ewt-ud-2.5-191206.udpipe")
# Sample 100 speeches
set.seed(123)    #For reproducibility
sampled_speeches <- df_clean %>% sample_n(100)
# Lemmatize and POS tag with UDPipe
pos_validation_UDPipe <- udpipe_annotate(m_eng_loaded, x = sampled_speeches$text) %>%
as.data.frame()
# Lemmatize and POS tag with Spacyr
spacy_initialize(model = "en_core_web_sm")
pos_validation_spacy <- spacy_parse(sampled_speeches$text, lemma = TRUE, pos = TRUE, tag = TRUE)
# Save files for easier manual validation in Excel
pos_validation_UDPipe %>% write_xlsx("pos_validation_UDPipe.xlsx")
pos_validation_spacy %>% write_xlsx("pos_validation_spacy.xlsx")
unique(pos$upos)
unique(sentiment_lexicon$pos1)
# Mapping table
maptable <- data.frame(
"UDPipe POS" = c("NOUN", "VERB", "PUNCT", "CCONJ", "NUM", "SCONJ", "DET",
"ADP", "ADJ", "PROPN", "PART", "ADV", "AUX", "PRON",
"INTJ", "SYM", "X"),
"Description" = c("Noun", "Verb", "Punctuation", "Coordinating conjunction", "Numeral",
"Subordinating conjunction", "Determiner", "Adposition", "Adjective",
"Proper noun", "Particle", "Adverb", "Auxiliary", "Pronoun",
"Interjection", "Symbol", "Other"),
"Example tokens" = c("team, access, support", "commend, welcome, provide", ". , ()",
"and, or, but", "2020, two", "that, while, if, as", "a, the, what",
"in, to, by, with", "delighted, warm, flexible", "Member, House, European",
"'s, not, to", "certainly, very, preferably", "can, have, am",
"I, he, she, anyone", "yes, no, psst", "%, $, £", ""),
"Sentiment lexicon POS" = c("n", "v", "", "", "", "", "",
"", "a", "", "", "r", "", "",
"u", "", ""),
"Action" = c("change POS in lexicon: n --> NOUN", "change POS in lexicon: v --> VERB", "", "",
"", "", "", "", "change POS in lexicon: a --> ADJ", "", "",
"change POS in lexicon: r --> ADV", "", "", "change POS in lexicon: u --> INTJ",
"", ""),
check.names = FALSE
)
knitr::kable(maptable, caption = "Mapping table of POS tags")
# Mapping POS tags
sentiment_lexicon %>%
mutate(pos1 = case_when(pos1 == 'n' ~ 'NOUN',
pos1 == 'v' ~ 'VERB',
pos1 == 'a' ~ 'ADJ',
pos1 == 'r' ~ 'ADV',
pos1 == 'u' ~ 'INTJ')) -> sentiment_lexicon
# Create a lookup table that store the sentiments of each speech
negating_words <- c("not", "no", "never", "neither", "nor")
pos %>%
# Last 6 columns not needed
select(-tail(names(.), 6)) %>%
# Create 'valence' column as defined in the paper
# Negation and punctuation indicator column
mutate(is_negation = lemma %in% negating_words,
is_punctuation = upos == "PUNCT") %>%
# Running flag to identify regions between punctuations and regions between negating words
mutate(punctuation_block = cumsum(is_punctuation),
negation_block = cumsum(is_negation)) %>%
# If there is a switch in negation block inside the same punctuation block we assign valence
group_by(punctuation_block, negation_block) %>%
mutate(valence = ifelse(any(is_negation), 0, 1)) %>%
ungroup() %>%
# Remove temporary auxiliary columns
select(-is_negation, -is_punctuation, -negation_block, -negation_block) %>%
# Keep relevant POS tags only
filter(upos %in% c('NOUN', 'VERB', 'ADJ', 'ADV', 'INTJ')) %>%
# Map polarity values
left_join(sentiment_lexicon, by = c('lemma' = 'lemma', 'upos' = 'pos1')) %>%
# Calculate sentiment based on paper
mutate(sentiment = polarity*valence) %>%
# Calculate sum of sentiment for each speech and number of words that had a sentiment
group_by(doc_id) %>%
summarise(sentiment_sum = sum(replace_na(sentiment, 0)),
sentiment_count = sum(!is.na(sentiment) & sentiment != 0)) -> sentiments_by_speech
# Map the sentiments to the speeches in the original data df_clean
df_clean %>%
# Add the doc_id column to df_clean to join on it in the subsequent step
mutate(doc_id = paste0('doc', row_number())) %>%
left_join(sentiments_by_speech, by = 'doc_id') %>%
# Replace NA values with 0 in the sentiment_sum and sentiment_count columns
mutate(across(c(sentiment_sum, sentiment_count), ~ replace_na(.x, 0))) -> df_clean
pos_validation_UDPipe %>%
# Last 6 columns not needed
select(-tail(names(.), 6)) %>%
# Create 'valence' column as defined in the paper
mutate(valence = ifelse(lag(lemma) %in% negating_words & lead(upos) == "PUNCT", 0, 1)) %>%
# Keep relevant POS tags only
filter(upos %in% c('NOUN', 'VERB', 'ADJ', 'ADV', 'INTJ')) %>%
# Map polarity values
left_join(sentiment_lexicon, by = c('lemma' = 'lemma', 'upos' = 'pos1')) %>%
# Calculate sentiment based on paper
mutate(sentiment = polarity*valence) -> sentiment_validation
# Save file for easier manual validation in Excel
sentiment_validation %>% write_xlsx("sentiment_validation.xlsx")
# Visualize as in the paper
mblue <- "#002A48"
pblue <- "#3F5F75"
# Visualize the sentiment by date
df_clean %>%
group_by(debate_date) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
mutate(sentismooth = smooth.spline(average_sentiment, spar = 0.5)$y) %>%
ggplot(aes(x = debate_date)) +
geom_line(aes(y = average_sentiment), size = .1, colour=pblue) +
geom_point(aes(y = average_sentiment), size = 6, colour=pblue, shape=1, stroke=.25) +
geom_line(aes(y = sentismooth), size = 2, colour=mblue) +
xlab("Date") +
ylab('Sentiment') +
theme_minimal()
# Visualize the sentiment by date - standardized data, as in paper
df_clean %>%
group_by(debate_date) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
mutate(standardized_sentiment = scale(average_sentiment),
sentismooth = smooth.spline(standardized_sentiment, spar = 0.5)$y) %>%
ggplot(aes(x = debate_date)) +
geom_line(aes(y = standardized_sentiment), size = .1, colour=pblue) +
geom_point(aes(y = standardized_sentiment), size = 6, colour=pblue, shape=1, stroke=.25) +
geom_line(aes(y = sentismooth), size = 2, colour=mblue) +
xlab("Date") +
ylab('Sentiment') +
# scale_y_continuous(limits = c(-3,3)) +
theme_minimal()
# Visualize the sentiment by quarter - standardized data, as in paper
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum) / sum(sentiment_count))) %>%
mutate(standardized_sentiment = scale(average_sentiment),
sentismooth = smooth.spline(standardized_sentiment, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = standardized_sentiment), size = .1, colour = pblue) +
geom_point(aes(y = standardized_sentiment), size = 6, colour = pblue, shape = 1, stroke = .25) +
geom_line(aes(y = sentismooth), size = 2, colour = mblue) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Visualize the sentiment by year - standardized data, as in paper
df_clean %>%
group_by(year) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum) / sum(sentiment_count))) %>%
mutate(standardized_sentiment = scale(average_sentiment),
sentismooth = smooth.spline(standardized_sentiment, spar = 0.5)$y) %>%
ggplot(aes(x = year, group = 1)) +
geom_line(aes(y = standardized_sentiment), size = .1, colour = pblue) +
geom_point(aes(y = standardized_sentiment), size = 6, colour = pblue, shape = 1, stroke = .25) +
geom_line(aes(y = sentismooth), size = 2, colour = mblue) +
xlab("Date") +
ylab('Sentiment') +
scale_x_continuous(breaks=c(2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022))  +
theme_minimal()
# Plot by Government-Opposition sentiment
df_clean %>%
mutate(quarter = paste0(year(debate_date), "-Q", quarter(debate_date))) %>%
group_by(quarter, Government_Opposition) %>%
summarise(average_sentiment = ifelse(sum(sentiment_count) == 0, 0,
sum(sentiment_sum)/sum(sentiment_count))) %>%
pivot_wider(names_from = Government_Opposition, values_from = average_sentiment) %>%
select(-'NA') %>%
ungroup() %>%
mutate(sentismooth_government = smooth.spline(Government, spar = 0.5)$y,
sentismooth_opposition = smooth.spline(Opposition, spar = 0.5)$y) %>%
mutate(quarter = factor(quarter, levels = unique(quarter))) %>%
ggplot(aes(x = quarter, group = 1)) +
geom_line(aes(y = Government), size = .1, colour="#3F5F75") +
geom_point(aes(y = Government), size = 6, colour="#3F5F75", shape=1, stroke=.25) +
geom_line(aes(y = Opposition), size = .1, colour="#3FA8C3") +
geom_point(aes(y = Opposition), size = 6, colour="#3FA8C3", shape=1, stroke=.25) +
geom_line(aes(y = sentismooth_government, colour="Government"), size = 2) +
geom_line(aes(y = sentismooth_opposition, colour="Opposition"), size = 2) +
scale_colour_manual(name="", values=c(Government="#002A48",Opposition="#008BB0")) +
xlab("Quarter") +
ylab('Sentiment') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position=c(0.4,0.2),
legend.text = element_text(size = 10),
legend.key.height=unit(1.5,"line"),
legend.key.size=unit(2.5,"line"),
legend.key = element_blank())
